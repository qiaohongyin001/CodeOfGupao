## 分布式基本理论

互联网架构特点：高并发、海量数据

1. 什么事分布式
   1. 任务分解
   2. 节点通信
2. 分布式和集群关系
   1. 电商平台：用户、商品、订单、交易
   2. 分布式：一个业务拆分成多个子业务，部署在不同服务器上
   3. 集群：同一个业务，部署在多个服务器上
3. 什么是大型网站
   1. 访问量（QPS/TPS）
   2. 数据量（存储数据量）
4. 解决session跨域共享问题
   1. session sticky
   2. session replication
   3. session 集中存储：存储在DB、存储在缓存服务器redis
   4. cookie（主流）：access_token(userid/token/timestamp)、soa架构和微服务架构





### 一 领域驱动模型：（De-bug -Driven Development）

### 二 CAP 理论

1. 一致性（Consistency）：所有节点上的数据，时刻保持一致
2. 可用性（Availability）：每个请求都有响应，无论响应成功或失败
3. 分区容错（Partition-tolerance）：系统出现脑裂以后，可能导致某些 server 与集群中的其他机器失去联系
4. CAP理论仅适用于原子读写的Nosql场景，不适用于数据库系统

### 三 BASE 理论

基于 CAP 理论，CAP 理论并不适用于数据库事务（因为更新一些错误的数据而导致数据出现紊乱，无论什么样的数据库高可用方案都是徒劳），XA 事务虽然可以保证数据库在分布式系统下的 ACID 特性，但是会带来性能方面的影响。

eBay尝试了一种完全不同的套路，放宽了对事物ACID的要求，提出了BASE理论：

1. Basically available(系统基本可用)：数据库采用分片模式，把100万的用户数据分布在5个实例上。如果破坏了其中一个实例，仍然可以保证80%的用户可用。
2. soft-state(软状态)：在基于client-server模式的系统中，server 端是否有状态，决定了系统是否具备良好的水平扩展、负载均衡、故障恢复等特性。Service 端承诺会维护 client 端状态数据，这个状态仅仅维持一小段时间，这段时间以后，server 端就会丢失这个状态，回复正常状态。
3. Eventually consistent(数据最终一致性)

### 四 分布式架构下的高可用设计

#### 1 分布式架构下的搞可用设计

1. 避免单点故障
   1. 高负载均衡技术（failover/选址/硬件负载/软件负载/去中心化的软件负载（gossip（redis-cluster）））
   2. 热备（HA）
   3. 多机房（同城灾备，异地灾备）
2. 应用的高可用性
   1. 故障监控（系统监控（CPU、内存）/链路监控/日志监控）
   2. 应用的容错设计（服务降级、限流）自我保护能力
   3. 数据量（数据分片、读写分离）

#### 2 分布式架构下的可伸缩设计

1. 垂直伸缩：提升硬件能力
2. 水平伸缩：增加服务器

#### 3 CDN 全局负载均衡

1. 一般静态资源会放到CDN上

![](cnd.png)

























